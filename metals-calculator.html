<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê·€ê¸ˆì† ì„ ë¬¼ ê³„ì‚°ê¸°</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Bebas+Neue&family=Noto+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0b;
    --surface: #111114;
    --surface2: #18181d;
    --border: #2a2a35;
    --gold: #d4a842;
    --gold-dim: #8a6f35;
    --silver: #b8c8d8;
    --silver-dim: #5a6a78;
    --accent: #e8d5a3;
    --text: #edf2f7;
    --text-dim: #8a96a8;
    --green: #4ade80;
    --red: #f87171;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    font-weight: 300;
    min-height: 100vh;
    padding: 24px 16px;
  }
  .header {
    text-align: center;
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--border);
  }
  .header h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.8rem;
    letter-spacing: 6px;
    background: linear-gradient(135deg, var(--gold), var(--silver), var(--gold));
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 4px;
  }
  .header p {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: var(--text-dim);
    letter-spacing: 3px;
    text-transform: uppercase;
  }
  .container { max-width: 960px; margin: 0 auto; }

  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
  @media(max-width: 600px) { .grid-2 { grid-template-columns: 1fr; } }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
  }
  .card-title {
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: #b0bac8;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .card-title::before {
    content: '';
    display: inline-block;
    width: 6px; height: 6px;
    border-radius: 50%;
  }
  .gold-card .card-title::before { background: var(--gold); }
  .silver-card .card-title::before { background: var(--silver); }
  .ratio-card .card-title::before { background: #a78bfa; }
  .exchange-card .card-title::before { background: var(--green); }

  .input-group { display: flex; flex-direction: column; gap: 6px; }
  .input-group label {
    font-size: 0.72rem;
    color: #b0bac8;
    letter-spacing: 1px;
  }
  .input-row {
    display: flex;
    align-items: center;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .input-row:focus-within { border-color: var(--gold); }
  .input-row input {
    flex: 1;
    background: none;
    border: none;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 1.1rem;
    padding: 10px 14px;
    outline: none;
    width: 0;
  }
  .input-row .unit {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: #8a96a8;
    padding: 0 14px;
    white-space: nowrap;
    border-left: 1px solid var(--border);
  }

  .ratio-display {
    text-align: center;
    padding: 8px 0;
  }
  .ratio-num {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 3.2rem;
    letter-spacing: 4px;
    background: linear-gradient(135deg, var(--gold), #a78bfa);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1;
  }
  .ratio-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    color: var(--text-dim);
    letter-spacing: 2px;
    margin-top: 4px;
  }

  /* Price Table */
  .table-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 16px;
  }
  .table-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .table-header h2 {
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-dim);
  }
  .table-scroll { overflow-x: auto; }
  table {
    width: 100%;
    border-collapse: collapse;
    font-family: 'DM Mono', monospace;
    font-size: 0.82rem;
  }
  thead th {
    background: var(--surface2);
    padding: 10px 14px;
    text-align: right;
    font-size: 0.68rem;
    letter-spacing: 1.5px;
    color: var(--text-dim);
    font-weight: 400;
    white-space: nowrap;
  }
  thead th:first-child { text-align: center; }
  tbody tr { border-bottom: 1px solid rgba(42,42,53,0.5); transition: background 0.15s; }
  tbody tr:hover { background: rgba(255,255,255,0.02); }
  tbody tr.highlight-row { background: rgba(201,168,76,0.06); }
  tbody tr.highlight-row td:first-child { color: var(--gold); }
  tbody td {
    padding: 9px 14px;
    text-align: right;
    color: #edf2f7;
  }
  tbody td:first-child { text-align: center; color: #8a96a8; font-size: 0.75rem; }
  .gold-val { color: var(--gold); }
  .silver-val { color: var(--silver); }
  .highlight-silver { background: rgba(155,168,181,0.08) !important; }

  /* Silver bar section */
  .silverbar-card {
    background: linear-gradient(135deg, rgba(155,168,181,0.06), rgba(74,85,96,0.04));
    border: 1px solid var(--silver-dim);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
  }
  .silverbar-card .card-title::before { background: var(--silver); }

  .premium-display {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 16px;
    padding: 14px 18px;
    background: var(--bg);
    border-radius: 8px;
    border: 1px solid var(--border);
  }
  .premium-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: var(--text-dim);
    letter-spacing: 2px;
  }
  .premium-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    letter-spacing: 3px;
  }
  .premium-positive { color: var(--red); }
  .premium-negative { color: var(--green); }
  .premium-zero { color: var(--silver); }

  /* Google Sheets */
  .sheets-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
  }
  .sheets-card .card-title::before { background: #34d399; }

  .script-box {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px;
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    color: #6ee7b7;
    white-space: pre-wrap;
    overflow-x: auto;
    line-height: 1.6;
    max-height: 180px;
    overflow-y: auto;
    margin: 12px 0;
  }
  details summary {
    cursor: pointer;
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: var(--text-dim);
    letter-spacing: 1px;
    padding: 6px 0;
    user-select: none;
  }
  details summary:hover { color: var(--text); }

  .save-btn {
    display: block;
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--gold-dim), var(--gold));
    border: none;
    border-radius: 10px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 5px;
    color: #0a0a0b;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
    margin-top: 8px;
  }
  .save-btn:hover { opacity: 0.88; transform: translateY(-1px); }
  .save-btn:active { transform: translateY(0); }
  .save-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(60px);
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 24px;
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    color: var(--text);
    letter-spacing: 1px;
    transition: transform 0.3s ease;
    z-index: 1000;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }
  .toast.success { border-color: var(--green); color: var(--green); }
  .toast.error { border-color: var(--red); color: var(--red); }

  .wbtn {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    padding: 6px 14px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: #b0bac8;
    cursor: pointer;
    transition: all 0.15s;
  }
  .wbtn:hover { border-color: var(--silver); color: #fff; }
  .wbtn.active { border-color: var(--silver); color: #fff; background: rgba(155,168,181,0.12); }

  .dim { color: var(--text-dim); }
  .mt8 { margin-top: 8px; }

  .silverbar-input-row {
    display: flex;
    gap: 12px;
    align-items: flex-end;
    flex-wrap: wrap;
  }
  .silverbar-input-row .input-group { flex: 1; min-width: 140px; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Precious Metals</h1>
    <p>ì„ ë¬¼ ê°€ê²© Â· í™˜ìœ¨ Â· í”„ë¦¬ë¯¸ì—„ ê³„ì‚°ê¸°</p>
  </div>

  <!-- Input Row -->
  <div class="grid-2">
    <!-- Gold -->
    <div class="card gold-card">
      <div class="card-title">ê¸ˆ ì„ ë¬¼ ê°€ê²©</div>
      <div class="input-group">
        <div class="input-row">
          <input type="number" id="goldPrice" placeholder="2350" step="0.1">
          <span class="unit">USD / troy oz</span>
        </div>
      </div>
    </div>
    <!-- Silver -->
    <div class="card silver-card">
      <div class="card-title">ì€ ì„ ë¬¼ ê°€ê²©</div>
      <div class="input-group">
        <div class="input-row">
          <input type="number" id="silverPrice" placeholder="28.5" step="0.01">
          <span class="unit">USD / troy oz</span>
        </div>
      </div>
    </div>
    <!-- Exchange Rate -->
    <div class="card exchange-card">
      <div class="card-title">í™˜ìœ¨</div>
      <div class="input-group">
        <div class="input-row">
          <input type="number" id="exchangeRate" placeholder="1380" step="1">
          <span class="unit">KRW / USD</span>
        </div>
      </div>
    </div>
    <!-- Ratio -->
    <div class="card ratio-card">
      <div class="card-title">ê¸ˆ / ì€ ë¹„ìœ¨ (Gold-Silver Ratio)</div>
      <div class="ratio-display">
        <div class="ratio-num" id="ratioDisplay">â€”</div>
        <div class="ratio-label">GOLD Ã· SILVER</div>
      </div>
    </div>
  </div>

  <!-- Premium Price Table -->
  <div class="table-card">
    <div class="table-header">
      <h2>ğŸ’° í”„ë¦¬ë¯¸ì—„ë³„ ê°€ê²©í‘œ (VAT í¬í•¨, ë§Œì›/g)</h2>
    </div>
    <div class="table-scroll">
      <table>
        <thead>
          <tr>
            <th>í”„ë¦¬ë¯¸ì—„</th>
            <th class="gold-val">ê¸ˆ 100g (ë§Œì›)</th>
            <th class="silver-val">ì€ 1kg (ë§Œì›)</th>
            <th class="gold-val">ê¸ˆ 1kg (ë§Œì›)</th>
          </tr>
        </thead>
        <tbody id="priceTableBody">
          <tr><td colspan="4" style="text-align:center;color:var(--text-dim);padding:24px;font-family:'DM Mono',monospace;font-size:0.75rem;letter-spacing:2px;">â€” ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš” â€”</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Silver Bar Section -->
  <div class="silverbar-card">
    <div class="card-title">ì‹¤ë²„ë°” í”„ë¦¬ë¯¸ì—„ ê³„ì‚°</div>
    <div class="silverbar-input-row">
      <div class="input-group">
        <label>ì‹¤ë²„ë°” ê°€ê²©</label>
        <div class="input-row">
          <input type="number" id="silverbarPrice" placeholder="550" step="1">
          <span class="unit">ë§Œì› / kg</span>
        </div>
      </div>
    </div>
    <div class="premium-display" id="premiumDisplay" style="display:none">
      <div>
        <div class="premium-label">ì‹¤ì œ í”„ë¦¬ë¯¸ì—„</div>
        <div style="font-family:'DM Mono',monospace;font-size:0.7rem;color:var(--text-dim);margin-top:4px" id="premiumBase">ê¸°ì¤€ê°€: â€”</div>
      </div>
      <div class="premium-value" id="premiumValue">â€”</div>
    </div>
  </div>

  <!-- Custom Premium Calculator -->
  <div class="card" style="margin-bottom:16px;background:var(--surface)">
    <div class="card-title" style="color:var(--text-dim)">
      <span style="display:inline-block;width:6px;height:6px;border-radius:50%;background:#f59e0b;margin-right:8px"></span>
      í”„ë¦¬ë¯¸ì—„ ì ì •ê°€ ê³„ì‚°ê¸°
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px">
      <div class="input-group">
        <label>ì ìš©í•  í”„ë¦¬ë¯¸ì—„ %</label>
        <div class="input-row">
          <input type="number" id="customPremium" placeholder="15" step="0.1" min="0" max="200">
          <span class="unit">%</span>
        </div>
      </div>
    </div>
    <div id="customPremiumResult" style="display:none;background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px">
      <div style="font-family:'DM Mono',monospace;font-size:0.65rem;letter-spacing:2px;color:var(--text-dim);margin-bottom:12px">VAT í¬í•¨ ì ì •ê°€</div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px">
        <div style="text-align:center;padding:10px 6px;background:rgba(201,168,76,0.07);border-radius:8px;border:1px solid rgba(201,168,76,0.15)">
          <div style="font-family:'DM Mono',monospace;font-size:0.62rem;color:var(--gold-dim);letter-spacing:1px;margin-bottom:6px">ê¸ˆ 100g</div>
          <div class="gold-val" id="cp_gold100" style="font-family:'DM Mono',monospace;font-size:1rem;font-weight:500">â€”</div>
          <div style="font-family:'DM Mono',monospace;font-size:0.6rem;color:var(--text-dim);margin-top:2px">ë§Œì›</div>
        </div>
        <div style="text-align:center;padding:10px 6px;background:rgba(155,168,181,0.07);border-radius:8px;border:1px solid rgba(155,168,181,0.15)">
          <div style="font-family:'DM Mono',monospace;font-size:0.62rem;color:var(--silver-dim);letter-spacing:1px;margin-bottom:6px">ì€ 1kg</div>
          <div class="silver-val" id="cp_silver1k" style="font-family:'DM Mono',monospace;font-size:1rem;font-weight:500">â€”</div>
          <div style="font-family:'DM Mono',monospace;font-size:0.6rem;color:var(--text-dim);margin-top:2px">ë§Œì›</div>
        </div>
        <div style="text-align:center;padding:10px 6px;background:rgba(201,168,76,0.07);border-radius:8px;border:1px solid rgba(201,168,76,0.15)">
          <div style="font-family:'DM Mono',monospace;font-size:0.62rem;color:var(--gold-dim);letter-spacing:1px;margin-bottom:6px">ê¸ˆ 1kg</div>
          <div class="gold-val" id="cp_gold1k" style="font-family:'DM Mono',monospace;font-size:1rem;font-weight:500">â€”</div>
          <div style="font-family:'DM Mono',monospace;font-size:0.6rem;color:var(--text-dim);margin-top:2px">ë§Œì›</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Shop Links -->
  <div class="card" style="margin-bottom:16px;background:var(--surface)">
    <div class="card-title" style="color:var(--text-dim)">
      <span style="display:inline-block;width:6px;height:6px;border-radius:50%;background:#60a5fa;margin-right:8px"></span>
      ê·€ê¸ˆì† ì‡¼í•‘ëª° ë°”ë¡œê°€ê¸°
    </div>
    <div style="display:flex;flex-direction:column;gap:8px">
      <a href="https://www.dsmint.com/sp2/goods_data_list.htm?cate_code=021001" target="_blank" style="display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--bg);border:1px solid var(--border);border-radius:8px;text-decoration:none;transition:border-color 0.2s" onmouseover="this.style.borderColor='#60a5fa'" onmouseout="this.style.borderColor='var(--border)'">
        <div>
          <div style="font-family:'DM Mono',monospace;font-size:0.75rem;color:var(--text);letter-spacing:1px">ëŒ€ì„±ê¸ˆì†</div>
          <div style="font-family:'DM Mono',monospace;font-size:0.62rem;color:var(--text-dim);margin-top:2px">dsmint.com</div>
        </div>
        <span style="color:#60a5fa;font-size:1rem">â†’</span>
      </a>
      <a href="https://www.goldgold.co.kr/product/list.html?cate_no=257" target="_blank" style="display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--bg);border:1px solid var(--border);border-radius:8px;text-decoration:none;transition:border-color 0.2s" onmouseover="this.style.borderColor='#60a5fa'" onmouseout="this.style.borderColor='var(--border)'">
        <div>
          <div style="font-family:'DM Mono',monospace;font-size:0.75rem;color:var(--text);letter-spacing:1px">í•œêµ­í‘œì¤€ê¸ˆê±°ë˜ì†Œ</div>
          <div style="font-family:'DM Mono',monospace;font-size:0.62rem;color:var(--text-dim);margin-top:2px">goldgold.co.kr</div>
        </div>
        <span style="color:#60a5fa;font-size:1rem">â†’</span>
      </a>
      <a href="https://www.goodgold.co.kr/shop/list-1020" target="_blank" style="display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--bg);border:1px solid var(--border);border-radius:8px;text-decoration:none;transition:border-color 0.2s" onmouseover="this.style.borderColor='#60a5fa'" onmouseout="this.style.borderColor='var(--border)'">
        <div>
          <div style="font-family:'DM Mono',monospace;font-size:0.75rem;color:var(--text);letter-spacing:1px">êµ­ì œí‘œì¤€ê¸ˆê±°ë˜ì†Œ</div>
          <div style="font-family:'DM Mono',monospace;font-size:0.62rem;color:var(--text-dim);margin-top:2px">goodgold.co.kr</div>
        </div>
        <span style="color:#60a5fa;font-size:1rem">â†’</span>
      </a>
    </div>
  </div>

  <!-- ì‹¤ë²„ë°” ì‹ ì²­ ê¸ˆì•¡ ì‚°ì • -->
  <div class="card" style="margin-bottom:16px;background:var(--surface);border-color:var(--silver-dim)">
    <div class="card-title">
      <span style="display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--silver);margin-right:8px"></span>
      ì‹¤ë²„ë°” ì‹ ì²­ ê¸ˆì•¡ ì‚°ì •
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
      <!-- ê·¸ë˜ë‰¼ ê°€ê²© -->
      <div class="input-group" style="grid-column:1/-1">
        <label>ê·¸ë˜ë‰¼ ê°€ê²©</label>
        <div class="input-row">
          <input type="number" id="granulePrice" placeholder="450" step="1" oninput="calcOrder()">
          <span class="unit">ë§Œì› / kg</span>
        </div>
      </div>
      <!-- ì¶”ê°€ ê¸ˆì•¡ -->
      <div class="input-group" style="grid-column:1/-1">
        <label>ì¶”ê°€ ê¸ˆì•¡ (gë‹¹)</label>
        <div class="input-row">
          <input type="number" id="extraAmt" placeholder="0" step="1" oninput="calcOrder()">
          <span class="unit">ì› / g</span>
        </div>
      </div>
      <!-- ë§ˆì§„ -->
      <div class="input-group">
        <label>ë§ˆì§„ (kgë‹¹)</label>
        <div class="input-row">
          <input type="number" id="marginAmt" placeholder="0" step="1" oninput="calcOrder()">
          <span class="unit">ë§Œì› / kg</span>
        </div>
      </div>
      <!-- ê³µì„ë¹„ -->
      <div class="input-group">
        <label>ê³µì„ë¹„ (kgë‹¹)</label>
        <div class="input-row">
          <input type="number" id="laborPerG" placeholder="500" step="10" oninput="calcOrder()">
          <span class="unit">ë§Œì› / kg</span>
        </div>
      </div>
      </div>
      <!-- ì‹ ì²­ ì¤‘ëŸ‰ -->
      <div class="input-group" style="grid-column:1/-1">
        <label>ì‹ ì²­ ì¤‘ëŸ‰</label>
        <div class="input-row">
          <input type="number" id="orderWeight" placeholder="1" step="1" min="1" oninput="calcOrder()">
          <span class="unit">kg</span>
        </div>
        <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap">
          <button onclick="setWeight(1)" id="wbtn_1" class="wbtn">1kg</button>
          <button onclick="setWeight(2)" id="wbtn_2" class="wbtn">2kg</button>
          <button onclick="setWeight(3)" id="wbtn_3" class="wbtn">3kg</button>
          <button onclick="setWeight(5)" id="wbtn_5" class="wbtn">5kg</button>
          <button onclick="setWeight(10)" id="wbtn_10" class="wbtn">10kg</button>
        </div>
      </div>
    </div>

    <!-- ê²°ê³¼ -->
    <div id="orderResult" style="display:none;background:var(--bg);border:1px solid var(--border);border-radius:10px;overflow:hidden">
      <div style="padding:14px 16px;border-bottom:1px solid var(--border)">
        <div style="font-family:'DM Mono',monospace;font-size:0.62rem;letter-spacing:2px;color:var(--text-dim);margin-bottom:10px">ê³„ì‚° ë‚´ì—­</div>
        <div style="display:flex;flex-direction:column;gap:7px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <span style="font-family:'DM Mono',monospace;font-size:0.72rem;color:#a0aec0">ê·¸ë˜ë‰¼ ì›ê°€</span>
            <span style="font-family:'DM Mono',monospace;font-size:0.78rem;color:#e2e8f0" id="ord_granule">â€”</span>
          </div>
          <div id="ord_labor_row" style="display:flex;justify-content:space-between;align-items:center">
            <span style="font-family:'DM Mono',monospace;font-size:0.72rem;color:#a0aec0">ê³µì„ë¹„</span>
            <span style="font-family:'DM Mono',monospace;font-size:0.78rem;color:#e2e8f0" id="ord_labor">â€”</span>
          </div>
          <div id="ord_margin_row" style="display:flex;justify-content:space-between;align-items:center">
            <span style="font-family:'DM Mono',monospace;font-size:0.72rem;color:#a0aec0">ë§ˆì§„</span>
            <span style="font-family:'DM Mono',monospace;font-size:0.78rem;color:#4ade80" id="ord_margin">â€”</span>
          </div>
          <div id="ord_extra_row" style="display:flex;justify-content:space-between;align-items:center">
            <span style="font-family:'DM Mono',monospace;font-size:0.72rem;color:#a0aec0">ì¶”ê°€ ê¸ˆì•¡</span>
            <span style="font-family:'DM Mono',monospace;font-size:0.78rem;color:#fbbf24" id="ord_extra">â€”</span>
          </div>
          <div style="height:1px;background:var(--border);margin:2px 0"></div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <span style="font-family:'DM Mono',monospace;font-size:0.72rem;color:#a0aec0">í•©ê³„</span>
            <span style="font-family:'DM Mono',monospace;font-size:0.78rem;color:#e2e8f0" id="ord_subtotal">â€”</span>
          </div>
        </div>
      </div>
      <div style="padding:14px 16px;display:flex;justify-content:space-between;align-items:center;background:rgba(155,168,181,0.05)">
        <div>
          <div style="font-family:'DM Mono',monospace;font-size:0.62rem;letter-spacing:2px;color:#a0aec0">ìµœì¢… ì‹ ì²­ ê¸ˆì•¡</div>
          <div style="font-family:'DM Mono',monospace;font-size:0.65rem;color:#a0aec0;margin-top:3px" id="ord_weight_label"></div>
        </div>
        <div style="text-align:right">
          <div style="font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:3px;color:#c6d9e8" id="ord_total">â€”</div>
          <div style="font-family:'DM Mono',monospace;font-size:0.62rem;color:#a0aec0">ë§Œì›</div>
        </div>
      </div>
    </div>
  </div>

  <div class="sheets-card">
    <div class="card-title">Google Sheets ì €ì¥</div>
    <div class="input-group mt8">
      <label>Apps Script ì›¹ì•± URL</label>
      <div class="input-row" style="flex-direction:row">
        <input type="text" id="scriptUrl" placeholder="https://script.google.com/macros/s/..." style="font-size:0.78rem">
      </div>
    </div>
    <details style="margin-top:14px">
      <summary>ğŸ“‹ Google Apps Script ì„¤ì • ë°©ë²• (í´ë¦­í•´ì„œ í¼ì¹˜ê¸°)</summary>
      <div style="margin-top:10px;font-size:0.75rem;color:var(--text-dim);line-height:1.7;padding:0 4px">
        1. <a href="https://script.google.com" target="_blank" style="color:var(--gold)">script.google.com</a>ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±<br>
        2. ì•„ë˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ê¸°<br>
        3. ë°°í¬ â†’ ìƒˆ ë°°í¬ â†’ ìœ í˜•: ì›¹ ì•± â†’ ì•¡ì„¸ìŠ¤: ë‚˜ë§Œ â†’ ë°°í¬<br>
        4. ìƒì„±ëœ URLì„ ìœ„ ì…ë ¥ì°½ì— ë¶™ì—¬ë„£ê¸°
      </div>
      <div class="script-box" id="scriptCode"></div>
    </details>
    <button class="save-btn" id="saveBtn" onclick="saveToSheets()">SAVE TO GOOGLE SHEETS</button>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
const TROY_OZ = 31.1035;
const PREMIUMS = [0,5,10,15,20,25,30,35,40,45,50];

function getInputs() {
  return {
    gold: parseFloat(document.getElementById('goldPrice').value) || 0,
    silver: parseFloat(document.getElementById('silverPrice').value) || 0,
    rate: parseFloat(document.getElementById('exchangeRate').value) || 0,
    silverbar: parseFloat(document.getElementById('silverbarPrice').value) || 0,
  };
}

// price per gram in ë§Œì› with VAT and premium
function calcPrice(futuresUSD, rate, premiumPct) {
  const krwPerGram = futuresUSD * rate / TROY_OZ; // KRW/g
  const withPremium = krwPerGram * (1 + premiumPct / 100);
  const withVAT = withPremium * 1.1;
  return withVAT / 10000; // ë§Œì›/g
}

function fmt(val, dec=2) {
  if (!val || isNaN(val)) return 'â€”';
  return val.toFixed(dec);
}

function update() {
  const { gold, silver, rate } = getInputs();

  // Ratio
  const ratioEl = document.getElementById('ratioDisplay');
  if (gold > 0 && silver > 0) {
    ratioEl.textContent = (gold / silver).toFixed(2);
  } else {
    ratioEl.textContent = 'â€”';
  }

  // Price table
  const tbody = document.getElementById('priceTableBody');
  if (gold > 0 && silver > 0 && rate > 0) {
    const rows = PREMIUMS.map(p => {
      const gPrice = calcPrice(gold, rate, p);
      const sPrice = calcPrice(silver, rate, p);
      const highlight = p === 0 ? 'highlight-row' : '';
      return `<tr class="${highlight}">
        <td>${p === 0 ? '<span style="color:var(--gold);font-weight:500">0%</span>' : p + '%'}</td>
        <td class="gold-val">${fmt(gPrice * 100)}</td>
        <td class="silver-val">${fmt(sPrice * 1000)}</td>
        <td class="gold-val">${fmt(gPrice * 1000)}</td>
      </tr>`;
    });
    tbody.innerHTML = rows.join('');
  } else {
    tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;color:var(--text-dim);padding:24px;font-family:'DM Mono',monospace;font-size:0.75rem;letter-spacing:2px;">â€” ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš” â€”</td></tr>`;
  }

  // Silver bar premium â€” silverbar input is ë§Œì›/kg
  const { silverbar } = getInputs();
  const premDisplay = document.getElementById('premiumDisplay');
  if (silver > 0 && rate > 0 && silverbar > 0) {
    const basePricePerG = calcPrice(silver, rate, 0); // VAT included, premium 0%, ë§Œì›/g
    const basePricePerKg = basePricePerG * 1000;     // ë§Œì›/kg
    const premiumPct = ((silverbar - basePricePerKg) / basePricePerKg) * 100;
    const valEl = document.getElementById('premiumValue');
    valEl.textContent = (premiumPct >= 0 ? '+' : '') + premiumPct.toFixed(2) + '%';
    valEl.className = 'premium-value ' + (premiumPct > 0 ? 'premium-positive' : premiumPct < 0 ? 'premium-negative' : 'premium-zero');
    document.getElementById('premiumBase').textContent = `ê¸°ì¤€ê°€ (VAT í¬í•¨, í”„ë¦¬ë¯¸ì—„ 0%): ${fmt(basePricePerKg)}ë§Œì›/kg`;
    premDisplay.style.display = 'flex';
  } else {
    premDisplay.style.display = 'none';
  }
  // Custom premium calculator
  const customPremium = parseFloat(document.getElementById('customPremium').value);
  const cpResult = document.getElementById('customPremiumResult');
  if (gold > 0 && silver > 0 && rate > 0 && !isNaN(customPremium) && customPremium >= 0) {
    const gPrice = calcPrice(gold, rate, customPremium);
    const sPrice = calcPrice(silver, rate, customPremium);
    document.getElementById('cp_gold100').textContent = fmt(gPrice * 100);
    document.getElementById('cp_silver1k').textContent = fmt(sPrice * 1000);
    document.getElementById('cp_gold1k').textContent = fmt(gPrice * 1000);
    cpResult.style.display = 'block';
  } else {
    cpResult.style.display = 'none';
  }
}

function setWeight(n) {
  document.getElementById('orderWeight').value = n;
  document.querySelectorAll('.wbtn').forEach(b => b.classList.remove('active'));
  const btn = document.getElementById('wbtn_' + n);
  if (btn) btn.classList.add('active');
  calcOrder();
}

function calcOrder() {
  const granulePerKg = parseFloat(document.getElementById('granulePrice').value) || 0;
  const laborPerG    = parseFloat(document.getElementById('laborPerG').value)    || 0;
  const marginAmt    = parseFloat(document.getElementById('marginAmt').value)    || 0;
  const extraAmt     = parseFloat(document.getElementById('extraAmt').value)     || 0;
  const weightKg     = parseFloat(document.getElementById('orderWeight').value)  || 0;

  // sync kg buttons
  document.querySelectorAll('.wbtn').forEach(b => b.classList.remove('active'));
  const activeBtn = document.getElementById('wbtn_' + weightKg);
  if (activeBtn) activeBtn.classList.add('active');

  const result = document.getElementById('orderResult');
  if (!granulePerKg && !weightKg) { result.style.display = 'none'; return; }

  const weightG     = weightKg * 1000;
  const granuleCost = granulePerKg * weightKg;
  const laborCost   = laborPerG * weightKg;                // ë§Œì›/kg ê¸°ì¤€ Ã— ì¤‘ëŸ‰
  const extraCost   = (extraAmt * weightG) / 10000;        // ì›/g Ã— g â†’ ë§Œì›
  const marginTotal = marginAmt * weightKg;                // ë§Œì›/kg ê¸°ì¤€ Ã— ì¤‘ëŸ‰
  const total       = granuleCost + laborCost + marginTotal + extraCost;

  document.getElementById('ord_granule').textContent  = granuleCost > 0   ? granuleCost.toFixed(2) + ' ë§Œì›' : 'â€”';
  document.getElementById('ord_labor').textContent    = laborCost > 0     ? laborCost.toFixed(2)   + ' ë§Œì›' : 'â€”';
  document.getElementById('ord_margin').textContent   = marginTotal > 0   ? '+' + marginTotal.toFixed(2) + ' ë§Œì›' : 'â€”';
  document.getElementById('ord_extra').textContent    = extraCost > 0     ? '+' + extraCost.toFixed(2)   + ' ë§Œì›' : 'â€”';
  document.getElementById('ord_subtotal').textContent = total.toFixed(2) + ' ë§Œì›';
  document.getElementById('ord_total').textContent    = total.toFixed(2);
  document.getElementById('ord_weight_label').textContent = weightKg ? `ì¤‘ëŸ‰ ${weightKg}kg (${weightG.toLocaleString()}g)` : '';
  result.style.display = 'block';
}

// Google Apps Script code
document.getElementById('scriptCode').textContent = `function doPost(e) {
  const data = JSON.parse(e.postData.contents);
  const ss = SpreadsheetApp.openById("YOUR_SPREADSHEET_ID");
  const sheet = ss.getSheetByName("Sheet1") || ss.getSheets()[0];
  
  // Header if empty
  if (sheet.getLastRow() === 0) {
    sheet.appendRow([
      "ë‚ ì§œ", "ê¸ˆì„ ë¬¼(USD/oz)", "ì€ì„ ë¬¼(USD/oz)", "í™˜ìœ¨(KRW)",
      "ê¸ˆì€ë¹„ìœ¨", "ê¸ˆê¸°ì¤€ê°€(ë§Œì›/g)", "ì€ê¸°ì¤€ê°€(ë§Œì›/kg)",
      "ì‹¤ë²„ë°”ê°€ê²©(ë§Œì›/kg)", "ì‹¤ë²„ë°”í”„ë¦¬ë¯¸ì—„(%)"
    ]);
  }
  sheet.appendRow(data.row);
  
  return ContentService
    .createTextOutput(JSON.stringify({result:"ok"}))
    .setMimeType(ContentService.MimeType.JSON);
}`;

async function saveToSheets() {
  const scriptUrl = document.getElementById('scriptUrl').value.trim();
  if (!scriptUrl) {
    showToast('Apps Script URLì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
    return;
  }

  const { gold, silver, rate, silverbar } = getInputs();
  if (!gold || !silver || !rate) {
    showToast('ì„ ë¬¼ ê°€ê²©ê³¼ í™˜ìœ¨ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”', 'error');
    return;
  }

  const now = new Date();
  const dateStr = now.toLocaleDateString('ko-KR') + ' ' + now.toLocaleTimeString('ko-KR', {hour:'2-digit', minute:'2-digit'});
  const ratio = silver > 0 ? (gold / silver).toFixed(2) : '';
  const goldBase = calcPrice(gold, rate, 0);
  const silverBasePerG = calcPrice(silver, rate, 0);
  const silverBasePerKg = silverBasePerG * 1000;
  const premiumPct = (silver > 0 && rate > 0 && silverbar > 0)
    ? (((silverbar - silverBasePerKg) / silverBasePerKg) * 100).toFixed(2)
    : '';

  const row = [
    dateStr, gold, silver, rate,
    ratio,
    goldBase.toFixed(4), silverBasePerKg.toFixed(2),
    silverbar || '', premiumPct
  ];

  const btn = document.getElementById('saveBtn');
  btn.disabled = true;
  btn.textContent = 'SAVING...';

  try {
    await fetch(scriptUrl, {
      method: 'POST',
      body: JSON.stringify({ row }),
      headers: { 'Content-Type': 'application/json' },
      mode: 'no-cors'
    });
    showToast('âœ“ Google Sheetsì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
  } catch(err) {
    showToast('ì €ì¥ ì‹¤íŒ¨: ' + err.message, 'error');
  } finally {
    btn.disabled = false;
    btn.textContent = 'SAVE TO GOOGLE SHEETS';
  }
}

function showToast(msg, type='') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast ' + type;
  setTimeout(() => t.classList.add('show'), 10);
  setTimeout(() => { t.classList.remove('show'); }, 3000);
}

// Live update on input
['goldPrice','silverPrice','exchangeRate','silverbarPrice','customPremium'].forEach(id => {
  document.getElementById(id).addEventListener('input', update);
});
</script>
</body>
</html>
